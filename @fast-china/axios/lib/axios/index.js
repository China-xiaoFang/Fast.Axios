"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const e=require("axios"),r=require("lodash-unified"),s=require("./fastAxios.js"),o=require("../uni-adapter/index.js");require("./type.js");const t={cancelDuplicateRequest:!0,loading:!1,loadingText:"加载中...",cache:!1,getMethodCacheHandle:!0,simpleDataFormat:!0,showErrorMessage:!0,showCodeMessage:!0,autoDownloadFile:!0,restfulResult:!0},l={cancelDuplicate:"重复请求，自动取消！",offLine:"您断网了！",fileDownloadError:"文件下载失败或此文件不存在！",302:"接口重定向了！",400:"参数不正确！",401:"您没有权限操作（令牌、用户名、密码错误）！",403:"您的访问是被禁止的！",404:"请求的资源不存在！",405:"请求的格式不正确！",408:"请求超时！",409:"系统已存在相同数据！",410:"请求的资源被永久删除，且不会再得到的！",422:"当创建一个对象时，发生一个验证错误！",429:"请求过于频繁，请稍后再试！",500:"服务器内部错误！",501:"服务未实现！",502:"网关错误！",503:"服务不可用，服务器暂时过载或维护！",504:"服务暂时无法访问，请稍后再试！",505:"HTTP版本不受支持！",[e.AxiosError.ETIMEDOUT]:"请求超时！",[e.AxiosError.ECONNABORTED]:"连接中断，服务器暂时过载或维护！",[e.AxiosError.ERR_NETWORK]:"网关错误，服务不可用，服务器暂时过载或维护！"},a=new Map,n=e=>{if(a.has(e)){a.get(e)(e),a.delete(e)}},i=e=>{if("undefined"!=typeof uni);else{const r=new Blob([e.data],{type:"application/octet-stream;charset=UTF-8"}),s=e.headers["content-disposition"],o=new RegExp("filename=([^;]+\\.[^\\.;]+);*").exec(s)[1],t=document.createElement("a"),l=window.URL.createObjectURL(r),a=/^["](.*)["]$/g;t.style.display="none",t.href=l,t.download=decodeURI(o.replace(a,"$1")),document.body.appendChild(t),t.click(),document.body.removeChild(t),window.URL.revokeObjectURL(l)}},u={request:u=>{var c;const d=s.useFastAxios(),p={...t,...u};if(r.isNil(p.requestCipher)&&(p.requestCipher=d.requestCipher),p.cache&&"GET"===p.method.toUpperCase()&&p.restfulResult&&p.simpleDataFormat){if(p.params&&console.warn("[Fast.Axios] 如果使用 Http Cache，则不能存在任何 'params' 参数"),null==(c=d.cache)?void 0:c.get){const e=d.cache.get(p.url);if(e)return Promise.resolve(e)}}else p.cache=!1;const m=(e=>{let{data:s}=e;const{url:o,method:t,params:l}=e;return r.isString(s)&&(s=JSON.parse(s)),[o,t,JSON.stringify(l),JSON.stringify(s)].join("&")})(u),v=Date.now(),g=e.create({adapter:"undefined"!=typeof uni?o.createUniAppAxiosAdapter():void 0,baseURL:d.baseUrl,timeout:d.timeout,headers:{...d.headers},responseType:"json"});return g.interceptors.request.use((r=>{var s,o,t;return n(m),p.cancelDuplicateRequest&&((r,s)=>{s.cancelToken=s.cancelToken||new e.CancelToken((e=>{a.has(r)||a.set(r,e)}))})(m,r),null==(s=d.interceptors)||s.request(r),p.loading&&(null==(o=d.loading)||o.show(p.loadingText)),"json"===r.responseType&&(p.requestCipher?null==(t=d.crypto)||t.encrypt(r,v):p.getMethodCacheHandle&&"GET"===r.method.toUpperCase()&&(r.params=r.params||{},r.params._=v)),r}),(e=>(console.error("[Fast.Axios]",e),Promise.reject(e)))),g.interceptors.response.use((s=>{var o,t,a,u,c,v,g;if(n(m),p.loading&&(null==(o=d.loading)||o.close(p)),null==(t=d.interceptors)?void 0:t.response)try{const e=d.interceptors.response(s,p);if(!r.isNil(e))return Promise.resolve(e)}catch(f){return console.error("[Fast.Axios]",f),Promise.reject(f)}if("blob"===s.config.responseType||"DOWNLOAD"===p.method.toUpperCase())return 200===s.status?(p.autoDownloadFile&&i(s),Promise.resolve(s)):(null==(a=d.message)||a.error(l.fileDownloadError),Promise.reject(s));if("json"===s.config.responseType){let o=s.data;if(p.restfulResult){const t=o,l=(null==t?void 0:t.code)??s.status;if(l<200||l>299||!1===(null==t?void 0:t.success))return p.showCodeMessage&&(null==t?void 0:t.message)&&(r.isObject(null==t?void 0:t.message)?null==(u=d.message)||u.error(JSON.stringify(null==t?void 0:t.message)):null==(c=d.message)||c.error(null==t?void 0:t.message)),console.error("[Fast.Axios]",new e.AxiosError((null==t?void 0:t.message)??"服务器内部错误！")),Promise.reject(new e.AxiosError((null==t?void 0:t.message)??"服务器内部错误！"))}return p.requestCipher&&(o=null==(v=d.crypto)?void 0:v.decrypt(s,p)),p.cache&&p.restfulResult&&p.simpleDataFormat&&(null==(g=d.cache)||g.set(p.url,null==o?void 0:o.data)),p.simpleDataFormat?Promise.resolve(null==o?void 0:o.data):Promise.resolve(o)}return p.simpleDataFormat?Promise.resolve(s.data):Promise.resolve(s)}),(async s=>{var o,t,a,i;if(n(m),p.loading&&(null==(o=d.loading)||o.close(p)),e.isCancel(s))return console.warn(`[Fast.Axios] ${l.cancelDuplicate}`),Promise.reject();if(!globalThis.navigator.onLine)return null==(t=d.message)||t.error(l.offLine),Promise.reject();if(null==(a=d.interceptors)?void 0:a.responseError)try{const e=d.interceptors.responseError(s,p);if(!r.isNil(e))return Promise.reject(e)}catch(u){return console.error("[Fast.Axios]",u),Promise.reject(u)}if(p.showErrorMessage){const e=await(async e=>{var r,s,o,t,a,n,i,u,c,d,p;let m="";const v=(null==(s=null==(r=null==e?void 0:e.response)?void 0:r.data)?void 0:s.code)||(null==(o=null==e?void 0:e.response)?void 0:o.status)||(null==e?void 0:e.code)||"default";if("blob"===(null==(t=null==e?void 0:e.request)?void 0:t.responseType))try{m=null==(i=JSON.parse(await(null==(n=null==(a=null==e?void 0:e.response)?void 0:a.data)?void 0:n.text())))?void 0:i.message}catch(g){m=(null==(c=null==(u=null==e?void 0:e.response)?void 0:u.data)?void 0:c.message)||l[v]}else m=(null==(p=null==(d=null==e?void 0:e.response)?void 0:d.data)?void 0:p.message)||l[v];return m})(s);null==(i=d.message)||i.error(e)}return console.error("[Fast.Axios]",s),Promise.reject(s)})),g(p)},downloadFile:i};exports.createFastAxios=s.createFastAxios,exports.useFastAxios=s.useFastAxios,exports.axiosUtil=u;
//# sourceMappingURL=index.js.map
