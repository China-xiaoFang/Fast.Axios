{"version":3,"file":"onCanceled.mjs","sources":["../../../../../src/uni-adapter/methods/onCanceled.ts"],"sourcesContent":["import { CanceledError } from \"axios\";\nimport type { AxiosRequestConfig, InternalAxiosRequestConfig } from \"axios\";\n\nexport default class OnCanceled<T> {\n\tconfig: AxiosRequestConfig<T>;\n\tprivate onCanceled?: (cancel?: any) => void;\n\tconstructor(config: AxiosRequestConfig<T>) {\n\t\tthis.config = config;\n\t}\n\n\tsubscribe(task: any, reject: any): void {\n\t\tif (this.config.cancelToken || this.config.signal) {\n\t\t\tthis.onCanceled = (cancel?: any): void => {\n\t\t\t\tif (!task) return;\n\n\t\t\t\treject(!cancel || cancel.type ? new CanceledError(undefined, undefined, this.config as InternalAxiosRequestConfig, task) : cancel);\n\t\t\t\ttask.abort();\n\t\t\t\ttask = null;\n\t\t\t};\n\t\t\tif (this.config.cancelToken) {\n\t\t\t\t// @ts-expect-error ignore\n\t\t\t\tthis.config.cancelToken.subscribe(this.onCanceled);\n\t\t\t}\n\n\t\t\tif (this.config.signal && this.config.signal.addEventListener) {\n\t\t\t\tthis.config.signal.aborted ? this.onCanceled() : this.config.signal.addEventListener(\"abort\", this.onCanceled);\n\t\t\t}\n\t\t}\n\t}\n\n\tunsubscribe(): void {\n\t\tif (this.config.cancelToken) {\n\t\t\t// @ts-expect-error ignore\n\t\t\tthis.config.cancelToken.unsubscribe(this.onCanceled);\n\t\t}\n\n\t\tif (this.config.signal && this.config.signal.removeEventListener) this.config.signal.removeEventListener(\"abort\", this.onCanceled);\n\t}\n}\n"],"names":[],"mappings":";;;;AAGA,MAAqB,WAAc;AAAA,EAGlC,YAAY,QAA+B;AAF3C;AACQ;AAEP,SAAK,SAAS;AAAA,EAAA;AAAA,EAGf,UAAU,MAAW,QAAmB;AACvC,QAAI,KAAK,OAAO,eAAe,KAAK,OAAO,QAAQ;AAC7C,WAAA,aAAa,CAAC,WAAuB;AACzC,YAAI,CAAC,KAAM;AAEX,eAAO,CAAC,UAAU,OAAO,OAAO,IAAI,cAAc,QAAW,QAAW,KAAK,QAAsC,IAAI,IAAI,MAAM;AACjI,aAAK,MAAM;AACJ,eAAA;AAAA,MACR;AACI,UAAA,KAAK,OAAO,aAAa;AAE5B,aAAK,OAAO,YAAY,UAAU,KAAK,UAAU;AAAA,MAAA;AAGlD,UAAI,KAAK,OAAO,UAAU,KAAK,OAAO,OAAO,kBAAkB;AAC9D,aAAK,OAAO,OAAO,UAAU,KAAK,WAAW,IAAI,KAAK,OAAO,OAAO,iBAAiB,SAAS,KAAK,UAAU;AAAA,MAAA;AAAA,IAC9G;AAAA,EACD;AAAA,EAGD,cAAoB;AACf,QAAA,KAAK,OAAO,aAAa;AAE5B,WAAK,OAAO,YAAY,YAAY,KAAK,UAAU;AAAA,IAAA;AAGpD,QAAI,KAAK,OAAO,UAAU,KAAK,OAAO,OAAO,oBAAqB,MAAK,OAAO,OAAO,oBAAoB,SAAS,KAAK,UAAU;AAAA,EAAA;AAEnI;"}