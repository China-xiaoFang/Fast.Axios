"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const e=require("axios"),o=require("lodash-unified"),s=require("./useAxios.js"),r=require("../uni-adapter/index.js");require("./type.js");const t="HTTP_CACHE_",l={cancelDuplicateRequest:!0,loading:!1,loadingText:"加载中...",cache:!1,getMethodCacheHandle:!0,simpleDataFormat:!0,showErrorMessage:!0,showCodeMessage:!0,autoDownloadFile:!0,restfulResult:!0},n={cancelDuplicate:"重复请求，自动取消！",offLine:"您断网了！",fileDownloadError:"文件下载失败或此文件不存在！",302:"接口重定向了！",400:"参数不正确！",401:"您没有权限操作（令牌、用户名、密码错误）！",403:"您的访问是被禁止的！",404:"请求的资源不存在！",405:"请求的格式不正确！",408:"请求超时！",409:"系统已存在相同数据！",410:"请求的资源被永久删除，且不会再得到的！",422:"当创建一个对象时，发生一个验证错误！",429:"请求过于频繁，请稍后再试！",500:"服务器内部错误！",501:"服务未实现！",502:"网关错误！",503:"服务不可用，服务器暂时过载或维护！",504:"服务暂时无法访问，请稍后再试！",505:"HTTP版本不受支持！",[e.AxiosError.ETIMEDOUT]:"请求超时！",[e.AxiosError.ECONNABORTED]:"连接中断，服务器暂时过载或维护！",[e.AxiosError.ERR_NETWORK]:"网关错误，服务不可用，服务器暂时过载或维护！"},a=new Map,i=e=>{if(a.has(e)){a.get(e)(e),a.delete(e)}},u=e=>{if("undefined"!=typeof uni);else{const o=new Blob([e.data],{type:"application/octet-stream;charset=UTF-8"}),s=e.headers["content-disposition"],r=new RegExp("filename=([^;]+\\.[^\\.;]+);*").exec(s)[1],t=document.createElement("a"),l=window.URL.createObjectURL(o),n=/^["](.*)["]$/g;t.style.display="none",t.href=l,t.download=decodeURI(r.replace(n,"$1")),document.body.appendChild(t),t.click(),document.body.removeChild(t),window.URL.revokeObjectURL(l)}},c={request:c=>{var d;const p=s.useAxios(),m={...l,...c};if(o.isNil(m.requestCipher)&&(m.requestCipher=p.requestCipher),m.cache&&"GET"===m.method.toUpperCase()&&m.restfulResult&&m.simpleDataFormat){m.params&&console.warn("[Fast.Axios] 如果使用 Http Cache，则不能存在任何 'params' 参数");const e=`${t}${m.url}`;if(null==(d=p.cache)?void 0:d.get){const o=p.cache.get(e);if(o)return Promise.resolve(o)}}else m.cache=!1;const v=(e=>{let{data:s}=e;const{url:r,method:t,params:l}=e;return o.isString(s)&&(s=JSON.parse(s)),[r,t,JSON.stringify(l),JSON.stringify(s)].join("&")})(c),g=Date.now(),f=e.create({adapter:"undefined"!=typeof uni?r.createUniAppAxiosAdapter():void 0,baseURL:p.baseUrl,timeout:p.timeout,headers:{...p.headers},responseType:"json"});return f.interceptors.request.use((o=>{var s,r,t;return i(v),m.cancelDuplicateRequest&&((o,s)=>{s.cancelToken=s.cancelToken||new e.CancelToken((e=>{a.has(o)||a.set(o,e)}))})(v,o),null==(s=p.interceptors)||s.request(o),m.loading&&(null==(r=p.loading)||r.show(m.loadingText)),"json"===o.responseType&&(m.requestCipher?null==(t=p.crypto)||t.encrypt(o,g):m.getMethodCacheHandle&&"GET"===o.method.toUpperCase()&&(o.params=o.params||{},o.params._=g)),o}),(e=>(console.error("[Fast.Axios]",e),Promise.reject(e)))),f.interceptors.response.use((s=>{var r,l,a,c,d,g,f;if(i(v),m.loading&&(null==(r=p.loading)||r.close(m)),null==(l=p.interceptors)?void 0:l.response)try{const e=p.interceptors.response(s,m);if(!o.isNil(e))return Promise.resolve(e)}catch(h){return console.error("[Fast.Axios]",h),Promise.reject(h)}if("blob"===s.config.responseType||"DOWNLOAD"===m.method.toUpperCase())return 200===s.status?(m.autoDownloadFile&&u(s),Promise.resolve(s)):(null==(a=p.message)||a.error(n.fileDownloadError),Promise.reject(s));if("json"===s.config.responseType){let r=s.data;if(m.restfulResult){const t=r,l=(null==t?void 0:t.code)??s.status;if(l<200||l>299||!1===(null==t?void 0:t.success))return m.showCodeMessage&&(null==t?void 0:t.message)&&(o.isObject(null==t?void 0:t.message)?null==(c=p.message)||c.error(JSON.stringify(null==t?void 0:t.message)):null==(d=p.message)||d.error(null==t?void 0:t.message)),console.error("[Fast.Axios]",new e.AxiosError((null==t?void 0:t.message)??"服务器内部错误！")),Promise.reject(new e.AxiosError((null==t?void 0:t.message)??"服务器内部错误！"))}if(m.requestCipher&&(r=null==(g=p.crypto)?void 0:g.decrypt(s,m)),m.cache&&m.restfulResult&&m.simpleDataFormat){const e=`${t}${m.url}`;null==(f=p.cache)||f.set(e,null==r?void 0:r.data)}return m.simpleDataFormat?Promise.resolve(null==r?void 0:r.data):Promise.resolve(r)}return m.simpleDataFormat?Promise.resolve(s.data):Promise.resolve(s)}),(async o=>{var s,r,t;if(i(v),m.loading&&(null==(s=p.loading)||s.close(m)),e.isCancel(o))return console.warn(`[Fast.Axios] ${n.cancelDuplicate}`),Promise.reject();if(!globalThis.navigator.onLine)return null==(r=p.message)||r.error(n.offLine),Promise.reject();if(m.showErrorMessage){const e=await(async e=>{var o,s,r,t,l,a,i,u,c,d,p;let m="";const v=(null==(s=null==(o=null==e?void 0:e.response)?void 0:o.data)?void 0:s.code)||(null==(r=null==e?void 0:e.response)?void 0:r.status)||(null==e?void 0:e.code)||"default";if("blob"===(null==(t=null==e?void 0:e.request)?void 0:t.responseType))try{m=null==(i=JSON.parse(await(null==(a=null==(l=null==e?void 0:e.response)?void 0:l.data)?void 0:a.text())))?void 0:i.message}catch(g){m=(null==(c=null==(u=null==e?void 0:e.response)?void 0:u.data)?void 0:c.message)||n[v]}else m=(null==(p=null==(d=null==e?void 0:e.response)?void 0:d.data)?void 0:p.message)||n[v];return m})(o);null==(t=p.message)||t.error(e)}return console.error("[Fast.Axios]",o),Promise.reject(o)})),f(m)},downloadFile:u};exports.useAxios=s.useAxios,exports.HTTP_CACHE_KEY=t,exports.axiosUtil=c;
//# sourceMappingURL=index.js.map
